#!/bin/bash
#

#docker images | grep '<none>' | awk '{print $3}'|xargs docker rmi &> /dev/null
WORKGIT=$1
BUILDDIR=$2
RPMPREFIX=$3
DEBPREFIX=$4
OS_LIST='centos5 centos6 ubuntu.12.04 ubuntu.14.04 wheezy oracle6'

if [ -n "$5" ]
then
  OS_LIST=$5
fi
mkdir logs > /dev/null
rm logs/*
mkdir logs2 > /dev/null
rm logs2/*

chmod +x get_modules
chmod +x run_tests_single_node_os
./get_modules $BUILDDIR $WORKGIT $RPMPREFIX



RC=0
for os in $OS_LIST
do

  ./run_tests_single_node_os $os $BUILDDIR &> logs2/$os.log &

done

wait

for os in $OS_LIST
do
  echo '-------------------------------------------------------------------------------------'
  echo
  cat logs2/$os.log
  echo
done

if [ -f logs/errors_exist ]
then
  echo 'errors exist in log files'
  exit 2
else
  exit 0
fi


docker images | grep '<none>' | awk '{print $3}'|xargs docker rmi
WORKGIT="https://github.com/narmitag/continuent-puppet-tungsten.git"


for os in centos5 centos6 squeeze wheezy ubuntu.10.04 ubuntu.12.04 ubuntu.14.04
do
  echo "Operating System =  $os"
  rm -rf base$os/tungsten
  git clone $WORKGIT base$os/tungsten
  docker build --no-cache -t="cbase/$os" base$os | grep Error:
  for f in puppet/*.pp
  do
   echo " ... $f"
   basedir=$(dirname $f)
   pwd=$(pwd)
   filename=$(basename $f)
   docker run --rm=true -v $pwd/$basedir:/mnt cbase/$os puppet apply /mnt/$filename | grep Error: | grep -v Unsupported
  done
done

#for os in  centos7
#do
#  echo "Operating System =  $os"
#  docker build --no-cache -t="cbase/$os" base$os | grep Error:
#  for f in puppet_centos7/*.pp
#  do
#   rm $os/puppet.pp
#   cp $f $os/puppet.pp
#   echo " ... $f"
#   docker build  -t="continuent/$os" $os | grep Error: | grep -v Unsupported
#  done
#done


for t in centos6-cluster u14.04-cluster
do
   rm -rf $t/tungsten
   git clone $WORKGIT $t/tungsten
   docker build --no-cache -t="continuent/$t" $t | grep Error:
   $t/launch
done
